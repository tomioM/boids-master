<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Boids</title>
  <script src="./boids.js"></script>
  <script src="./print.js"></script>
  <style type="text/css">
    body {
      margin: 0;
      background: #ffffff;
      overflow: hidden;
    }
    svg {
      opacity: 50%;
      position: absolute;
      fill: none;
      stroke: black;
      /* padding: 5%; */
    }
    canvas {
      pointer-events: auto; /* or none, depending */

    }


      #controlPanel {
        /* transform: scale(3); */
/* transform-origin: top right; */
    position: fixed;
    top: 20px;
    right: 20px;
    background: #1a1a1a;
    color: white;
    font-family: sans-serif;
    padding: 10px;
    border-radius: 10px;
    font-size: 12px;
    z-index: 10000;
    width: 220px;
    cursor: move;
    box-shadow: 0 0 10px #00000088;
  }

  #controlPanel input,
  #controlPanel select {
    width: 100%;
    margin: 2px 0 8px;
    font-size: 12px;
    background: #333;
    color: white;
    border: none;
    padding: 4px;
    border-radius: 5px;
  }

  #controlPanel label {
    font-weight: bold;
    display: block;
    margin-top: 6px;
  }

  .section {
    margin-bottom: 12px;
    border-bottom: 1px solid #444;
    padding-bottom: 8px;
  }
  </style>
</head>

<body>

  <svg version="1.1" id="shapeSVG"  width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" xml:space="preserve">
  <path id="boidPath" d="M2061.84,544.42h-694.02v-97.72c0-99.22-66.92-162.29-158.45-162.29s-158.45,63.07-158.45,162.29v180.75c0,30.77-23.07,54.61-52.3,54.61s-52.3-23.84-52.3-54.61v-180.75c0-99.22-66.92-162.29-158.45-162.29s-158.45,63.07-158.45,162.29v85.03l-828.09.02v1l828.09-.02v196.25c0,29.23,23.84,53.07,53.07,53.07s53.07-23.84,53.07-53.07v-288.44c0-30.77,23.08-54.61,52.3-54.61s52.3,23.84,52.3,54.61v180.75c0,99.22,66.92,162.29,158.45,162.29s158.45-63.07,158.45-162.29v-180.75c0-30.77,23.07-54.61,52.3-54.61s52.3,23.84,52.3,54.61v288.44c0,29.23,23.84,53.07,53.07,53.07s53.07-23.84,53.07-53.07v-183.56h694.02s0-1,0-1Z"/>
  </svg>


  <canvas id="boids" width="150" height="150"></canvas>

<div id="controlPanel">
  <div class="section">
    <label>Constraint Type</label>
    <select id="constraintType">
      <option value="window">window</option>
      <option value="shape">shape</option>
      <option value="none">none</option>
    </select>
  </div>

  <div class="section">
    <label><input type="checkbox" id="drawTail"> Draw Tail</label>
    <label>Tail Colour</label>
    <input type="color" id="tailColour" />
    <label>Tail Width</label>
    <input type="number" id="tailWidth" min="0" step="0.1">
  </div>

  <div class="section">
    <label>Size</label>
    <input type="number" id="size" step="1">
    <label>Min Distance</label>
    <input type="number" id="minDistance" step="1">
    <label>Num Boids</label>
    <input type="number" id="numBoids" step="1">
  </div>

  <div class="section">
    <label>Visual Range</label>
    <input type="number" id="visualRange" step="1">
    <label>Centering Factor</label>
    <input type="number" id="centeringFactor" step="0.001">
    <label>Matching Factor</label>
    <input type="number" id="matchingFactor" step="0.01">
    <label>Avoid Factor</label>
    <input type="number" id="avoidFactor" step="0.01">
    <label>Speed Limit</label>
    <input type="number" id="speedLimit" step="1">
  </div>

  <div class="section">
    <label>Grid Size</label>
    <input type="number" id="gridSize" step="1">
    <label>Threshold</label>
    <input type="number" id="threshold" step="1">
  </div>
</div>
<script>
  console.log("Hello")

// Interface
   const bindings = {
    constraintType: val => constraintType = val,
    drawTail: val => drawTail = val,
    tailColour: val => tailColour = val,
    tailWidth: val => tailWidth = parseFloat(val),
    size: val => size = parseFloat(val),
    minDistance: val => minDistance = parseFloat(val),
    numBoids: val => numBoids = parseInt(val),
    visualRange: val => visualRange = parseFloat(val),
    centeringFactor: val => centeringFactor = parseFloat(val),
    matchingFactor: val => matchingFactor = parseFloat(val),
    avoidFactor: val => avoidFactor = parseFloat(val),
    speedLimit: val => speedLimit = parseFloat(val),
    gridSize: val => gridSize = parseInt(val),
    threshold: val => threshold = parseFloat(val),
  };

  console.log(bindings)

  // Set values in UI
  document.getElementById("constraintType").value = constraintType;
  document.getElementById("drawTail").checked = drawTail;
  document.getElementById("tailColour").value = tailColour;
  document.getElementById("tailWidth").value = tailWidth;
  document.getElementById("size").value = size;
  document.getElementById("minDistance").value = minDistance;
  document.getElementById("numBoids").value = numBoids;
  document.getElementById("visualRange").value = visualRange;
  document.getElementById("centeringFactor").value = centeringFactor;
  document.getElementById("matchingFactor").value = matchingFactor;
  document.getElementById("avoidFactor").value = avoidFactor;
  document.getElementById("speedLimit").value = speedLimit;
  document.getElementById("gridSize").value = gridSize;
  document.getElementById("threshold").value = threshold;

  // Wire input updates
  for (const id in bindings) {
    const el = document.getElementById(id);
    if (!el) continue;
    el.addEventListener("input", () => {
      const value = el.type === "checkbox" ? el.checked : el.value;
      bindings[id](value);
    });
  }

  // Dragging logic
  const panel = document.getElementById("controlPanel");
  console.log(panel)
  let isDragging = false, offsetX, offsetY;

  panel.addEventListener("mousedown", (e) => {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
    isDragging = true;
    offsetX = e.clientX - panel.offsetLeft;
    offsetY = e.clientY - panel.offsetTop;
  });

  document.addEventListener("mousemove", (e) => {
    if (isDragging) {
      panel.style.left = `${e.clientX - offsetX}px`;
      panel.style.top = `${e.clientY - offsetY}px`;
    }
  });

  document.addEventListener("mouseup", () => isDragging = false);


</script>
</body>

</html>